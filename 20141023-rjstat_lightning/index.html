<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/styles/csshake.min.css">
    <link rel="stylesheet" type="text/css" href="/styles/zenburn.css">
    <link rel="stylesheet" type="text/css" href="/styles/planspace.css">
    <title>JSON-stat and rjstat</title>
  </head>
  <body>
    <article>
<h1>JSON-stat and rjstat</h1>
<p class="date">Thursday October 23, 2014</p>
<p><em>A <a href="http://www.meetup.com/stats-prog-dc/events/177772502/">lightning talk</a> for <a href="http://www.meetup.com/stats-prog-dc/">Statistical Programming DC</a>.</em></p>
<p><a href="http://json-stat.org/">JSON-stat</a> is a <a href="http://json.org/">JSON</a> <a href="http://en.wikipedia.org/wiki/Data_cube">data cube</a> packaging format. <a href="https://github.com/ajschumacher/rjstat">rjstat</a> is an <a href="http://www.r-project.org/">R</a> package for reading and writing JSON-stat.</p>
<hr />
<pre><code class="language-html">&lt;!doctype html>
&lt;html>
  &lt;head>
    &lt;title>data?&lt;/title>
...</code></pre>

<hr />
<p>About a year ago I was thinking about how to put a lot of data into a self-contained <a href="http://en.wikipedia.org/wiki/HTML">HTML</a> document. Presuming something text-based, what's the most compact way to store the data?</p>
<p>(If you're interested in self-contained HTML, I have a related <a href="https://www.python.org/">Python</a> <a href="https://pypi.python.org/pypi/selfcontain/">package</a> on <a href="https://pypi.python.org/">PyPI</a> called <a href="https://github.com/ajschumacher/selfcontain">selfcontain</a>.)</p>
<hr />
<pre><code class="language-json">[{"name": "Aaron",
  "year": 2014,
  "height": 68,
  "weight": 70},
...</code></pre>

<hr />
<p>It's pretty common online to see data as an array of objects in JSON. <a href="http://d3js.org/">D3</a> is happy to use this, for example. And it's good if you need to have every observation stand on its own, or if there's no consistent schema. But for every record you're repeating all the keys, so it isn't very compact.</p>
<hr />
<pre><code class="language-nohighlight">name,year,height,weight
Aaron,2014,68,70
...</code></pre>

<hr />
<p><a href="http://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> is generally much more compact, and the simple table layout is very familiar. There's even less data type information than with JSON, but that generally isn't such a big deal. D3 is still happy to read CSV. So CSV is a good way to save bytes over JSON arrays of objects. But can we do better?</p>
<hr />
<pre><code class="language-nohighlight">name,height2014,weight2014
Aaron,68,70
...</code></pre>

<hr />
<p>We could change the structure of the CSV data. Moving to a wider format might save bytes, as we don't repeat the year for every record. Of course this violates the rules of <a href="http://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a> and can be difficult to work with.</p>
<hr />
<pre><code class="language-nohighlight">name,year,thing,value
Aaron,2014,height,68
Aaron,2014,weight,70
...</code></pre>

<hr />
<p>We could move in the other direction, toward a longer format. Now there's only one column with values in it. We might object that the values now have presumably varying units, but we haven't been very concerned with units so far. For compactness though, we're clearly losing by duplicating names and years and things. If only there were a way to arrange the data so that nothing is repeated!</p>
<p>(For most wide-to-long and long-to-wide conversions in R, use the <a href="http://rpackages.ianhowson.com/cran/tidyr/man/gather.html">gather</a> and <a href="http://rpackages.ianhowson.com/cran/tidyr/man/spread.html">spread</a> functions from the <a href="https://github.com/hadley/tidyr">tidyr</a> package.)</p>
<hr />
<p><img alt="cube" src="cube.png" /></p>
<hr />
<p>One solution to this problem is the data cube approach. We track single copies of the dimensions and all the values fill the volume of the cube. This is compact, and if you're careful you might get benefits through <a href="http://en.wikipedia.org/wiki/Stride_of_an_array">striding</a>.</p>
<p>(<a href="http://commons.wikimedia.org/wiki/File:Necker_cube.svg">Image</a> (<a href="http://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Necker_cube.svg/1000px-Necker_cube.svg.png">1000-pixel PNG</a>)from <a href="http://commons.wikimedia.org/">Wikimedia Commons</a>).)</p>
<hr />
<pre><code class="language-json">{"people stats": {
  "value": [68, 70, ...],
  "dimension": {
    "id": ["name", "year", "thing"],
...</code></pre>

<hr />
<p>So this is what JSON-stat looks like. There's more to it, so the smallest CSV is certainly smaller than the smallest JSON-stat, but with large data sets it will be smaller. But that's not all.</p>
<hr />
<p>meta</p>
<hr />
<p>It stores metadata!</p>
<hr />
<p>Xavier Badosa</p>
<hr />
<p>Swedish Inflation Calculator
http://bl.ocks.org/badosa/20735ba5bbecbc079d78</p>
<p>Lars Pedersen (statistics Greenland)
http://www.scb.se/sv_/PC-Axis/Programs/PX-Web/PX-Web-examples/</p>
<hr />
<p><img alt="" src="bus.png" /></p>
<hr />
<p>http://agendadirectaonline.com/wp-content/uploads/2012/06/Bus-up-to-55-pax..png</p>
<p>https://github.com/ajschumacher/rjstat</p>
<p>Once it was up on GitHub, anybody could come and mess with it. And somebody did.</p>
<hr />
<p>Håkon Malmedal</p>
<hr />
<p>I don't know how recent this picture is.</p>
<p>https://twitter.com/hmalmedal</p>
<hr />
<p>CRAN</p>
<hr />
<p>http://cran.r-project.org/submit.html</p>
<p>approved by Uwe Ligges</p>
<p>now available via the <a href="http://cran.r-project.org/">Comprehensive R Archive Network</a> (CRAN).</p>    </article>
    <footer>
      <hr />
      <p>
        <a href="/"><span id="back_link" class="rotate180">➔</span></a>
        <a id="aaron_link" href="/aaron/">Aaron</a> is on
        <a href="https://twitter.com/planarrowspace">Twitter</a>,
        <a href="https://www.linkedin.com/in/ajschumacher">LinkedIn</a>,
        <a href="https://plus.google.com/112658546306232777448/">Google+</a>,
        <a href="https://github.com/ajschumacher">GitHub</a>,
        and
        <a href="mailto:ajschumacher@gmail.com">email</a>.
        <a href="javascript:window.scrollTo(0,0);"><span id="up_link" class="rotate270">➔</span></a>
      </p>
      <p>
        <a id="edit_link" href="https://github.com/ajschumacher/ajschumacher.github.io">Edit this</a>.
      </p>
    </footer>
    <script src="/scripts/highlight.pack.js"></script>
    <script src="/scripts/planspace.js"></script>
    <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-44351009-1', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>
